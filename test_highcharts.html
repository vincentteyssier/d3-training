<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>    
    <script src="./vendor/papaparse.js"></script>
    <script src="./vendor/jquery.js"></script>
</head>
<body>
    <div id="container" style="height: 400px; min-width: 1200px"></div>        
<script>
    $.get('data/sp500.csv', function (data) { 
        
        var options = {
            title: {
                text: 'S&P500'
            },
            xAxis: {
                title: {
                    text: 'Date'
                },
                gapGridLineWidth: 0,
                categories: []
            },
            yAxis: {
                title: {
                    text: 'Close value in USD'
                }
            },
            rangeSelector: {
                buttons: [{
                    type: 'day',
                    count: 1,
                    text: '1D'
                }, {
                    type: 'month',
                    count: 1,
                    text: '1M'
                }, {
                    type: 'all',
                    count: 1,
                    text: 'All'
                }],
                selected: 1,
                inputEnabled: true
            },
            series: [{
                name: 'S&P500',
                type: 'area',
                data: [],
                gapSize: 5,
                turboThreshold: 0,
                tooltip: {
                    valueDecimals: 2
                },
                fillColor: {
                    linearGradient: {
                        x1: 0,
                        y1: 0,
                        x2: 0,
                        y2: 1
                    },
                    stops: [
                        [0, Highcharts.getOptions().colors[0]],
                        [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                    ]
                },
                threshold: null
            }],
            pointStart: Date.UTC(2000, 1, 3),
            pointInterval: 24 * 3600 * 1000 // one day
        };

        // Split the lines
        var lines = data.split('\n');
        $.each(lines, function(lineNo, line) {
            var items = line.split(',');
            
            // skip header line
            if (lineNo == 0) { console.log(); }
            else {
                var close = { 
                    data: [],
                    name: "Close"
                };
                $.each(items, function(itemNo, item) {
                    // pushing the date in the x axis
                    if (itemNo == 0) options.xAxis['categories'].push(item);
                    // pushing the Close value for the serie value
                    if (itemNo == 4) options.series[0].data.push(item);
                });
                
            }
        });
        console.log(options.series[0]);
        console.log(options.xAxis.categories);

        var chart = new Highcharts.stockChart('container', options);
        // create the chart
        /*Highcharts.stockChart('container', {
            options                
                    //pointStart: Date.UTC(2000, 1, 3),
                    //pointInterval: 24 * 3600 * 1000 // one day
        });*/
    });
    </script>
</body>
</html>